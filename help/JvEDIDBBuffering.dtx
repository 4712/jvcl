##Package: EDI
##Status: Completed, Needs review
----------------------------------------------------------------------------------------------------
@@JvEDIDBBuffering.pas
Summary
  This unit contains components used in creating and maintaining a SQL database buffer for EDI data.
<INCLUDE JVCL.UnitText.dtx>
Author
  Raymond Alexander.

----------------------------------------------------------------------------------------------------
@@TJvAfterProfiledSegmentEvent
<TITLE TJvAfterProfiledSegmentEvent type>
<COMBINE TJvEDIDBProfiler.OnAfterProfiledSegment>

----------------------------------------------------------------------------------------------------
@@TJvAfterProfiledTransactionSetEvent
<TITLE TJvAfterProfiledTransactionSetEvent type>
<COMBINE TJvEDIDBProfiler.OnAfterProfiledTransactionSet>

----------------------------------------------------------------------------------------------------
@@TJvAlterTableEvent
<TITLE TJvOnAlterTableEvent type>
Summary
  A TJvEDIDBBuffer event.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvBeforeApplyElementFilterEvent
<TITLE TJvBeforeApplyElementFilterEvent type>
<COMBINE TJvEDIDBBuffer.OnBeforeApplyElementFilter>

----------------------------------------------------------------------------------------------------
@@TJvCheckForFieldChangesEvent
<TITLE TJvCheckForFieldChangesEvent type>
Summary
  A TJvEDIDBBuffer event.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvCreateTableEvent
<TITLE TJvCreateTableEvent type>
Summary
  A TJvEDIDBBuffer event.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer
<TITLEIMG TJvEDIDBBuffer>
JVCLInfo
  GROUP=JVCL.EDI
  FLAG=Component
Summary
  Use this component to create and update an EDI database buffer.
Description
  This is the generic TDataSet compatible EDI Database buffer component. For best results create a
  descendent component for TDataSet compatible third party components.

  Element , Loop, and Segment profile datasets are needed.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.ElementNonKeyPrefix
Summary
  Element non-key field name prefix.
Description
  The default prefix for element field names is "E".

  Examples:
  <PRE>
      Element 0143 is assigned the field name "E143_1".
      Element 0329 is assigned the field name "E329_1".
  </PRE>

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.ElementProfiles
Summary
  The dataset that contains element profiles.
Description
  The element profile is the collection of elements with the maximum length and usage used in a segment
  in transactions across all profiled EDI specification files.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.KeySuffix
Summary
  Key field name suffix.
Description
  The default suffix for key field names is "_Id".

  Examples:
  <PRE>
      Key field for segment table "ST" is assigned "ST_Id"
      Key field for loop table "0100" is assigned "Loop_0100_Id"
  </PRE>

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.LoopKeyPrefix
Summary
  Loop key field name prefix.
Description
  The default loop key field name prefix is ""Loop_".

  Examples:
  <PRE>
      Key field for loop table "0100" is assigned "Loop_0100_Id"
      Key field for loop table "0200" is assigned "Loop_0200_Id"
  </PRE>

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.LoopProfiles
Summary
  The dataset that contains loop profiles.
Description
  The loop profile is the collection of loops and their relationships in transactions of all profiled
  EDI specification files.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnAfterCloseDataSets
Summary
  Occurs after the profile datasets are closed.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnAfterOpenDataSets
Summary
  Occurs after the profile datasets are opened.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnAlterTable
Summary
  Occurs when a table needs to be altered.
Description
  Write the code here to alter a table based on the field definitions in the FieldDefs parameter.

  Each field definition status should be examined for the following values:

  <TABLE>
    Value       Meaning
    ----------  --------------------------------------
    usModified  Indicates the field was altered.
    usInserted  Indicates the field is new.
    usDeleted   Indicates the field should be deleted.
  </TABLE>
Parameters
  FieldDefs - The field definitions of the table.
  TableName - The name of the table.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnBeforeApplyElementFilter
Summary
  Occurs when it needs to be known if the default TDataSet filter capability should be used.
Description
  Use this event to apply a custom method of filtering to the ElementProfiles dataset if the TDataSet
  compatible component is not compatible with TDataSet filter capability.
Parameters
  DataSet     - The ElementProfile dataset.
  TableName   - The segment id table name that should be used to filter the correct element profile
                 records.
  ApplyFilter - For TDataSet components that do not support filters set the parameter to False.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnBeforeCloseDataSets
Summary
  Occurs before the profile datasets are closed.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnBeforeOpenDataSets
Summary
  Occurs before the profile datasets are opened.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnCheckForFieldChanges
Summary
  This event occurs when checking for changes to a table.
Description
  Write the code to check for changes to a table by comparing the current table field definitions to
  the field definitions given in the FieldDefs parameter. Update the field definitions in the
  FieldsDefs as necessary . Usually this involves changing the status of the field definitions in the
  FieldsDefs parameter to one of the following values:

  <TABLE>
    Value             Meaning
    ----------------  --------------------------------------
    usUnmodified      Default value
    usModified        Indicates the field was altered.
    usInserted        Indicates the field is new.
    usDeleted         Indicates the field should be deleted.
  </TABLE>

  Changes to the FieldsDefs parameter will end up being used in the TJvEDIDBBuffer.OnAlterTable event.
Parameters
  FieldDefs - The field definitions of the table to create.
  TableName - The name of the table to create.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnCreateTable
Summary
  Occurs when a table needs to be created.
Description
  Write the code to create a table (and indexes) based on the TableName and FieldDefs parameters.
Parameters
  FieldDefs - The field definitions of the table.
  TableName - The name of the table.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnResolveFieldDefType
Summary
  Resolve field types in this event.
Description
  Change field definition properties using this event. Using this event is optional.

  By default the following EDI Types map to the following TFieldTypes:

  <TABLE>
    EDI Type                TFieldType
    ----------------------  ----------
    EDIDataType_Numeric     ftInteger
    EDIDataType_Decimal     ftFloat
    EDIDataType_Identifier  ftString
    EDIDataType_String      ftString
    EDIDataType_Date        ftDate
    EDIDataType_Time        ftTime
    EDIDataType_Binary      ftBlob
    Any custom types        ftString
  </TABLE>
Parameters
  FieldDef - The field definition to examine and change.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.OnTableExists
Summary
  Occurs when the existence of a table needs to be determined.
Description
  Write the code necessary to determine if the table exists in the EDI database buffer. If the table
  does not exist then the OnCreateTable event will be raised.
Parameters
  TableName   - The table name to check the existence of.
  TableExists - Set this parameter to True if the table exists.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.SegmentKeyPrefix
Summary
  Segment key prefix.
Description
  There is no default value for this property.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.SegmentProfiles
Summary
  The dataset that contains segment profiles.
Description
  The segment profile is the collection of segments and their loop relationships in transactions of all
  profiled EDI specification files.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBBuffer.SyncProfilesWithBuffer
Summary
  The main method called to build and update the EDI database buffer.
Description
  Call this method to start the build and update of the EDI database buffer.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler
Summary
  The base EDI database profiler component.
Description
  The pupose of a TJvEDIDBProfiler decendent component is to build the ElementProfiles,
  SegmentProfiles, and LoopProfiles datasets for use with a TJvEDIDBBuffering type component.

  Create descendents of this component and override the abstract method BuildProfile in order to enable
  building profiles for different EDI specification file formats.

  The profiles become a sum of all EDI specification files that are profiled.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.AddElement
Summary
  Adds an element profile to the ElementProfiles dataset.
Description
  This method is designed to be called by the BuildProfile method and uses TDataSet compatible code.
Parameters
  SegmentId     - The segment id of the segment that the element is contained in.
  ElementId     - The element id of the element being added.
  ElementType   - The type of the element.
  MaximumLength - The maximum length of the element.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.AddLoop
Summary
  Adds a loop profile to the LoopProfiles dataset.
Description
  This method is designed to be called by the BuildProfile method and uses TDataSet compatible code.
Parameters
  OwnerLoopId  - The loop id of the loop being added.
  ParentLoopId - The parent loop id of the loop being added.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.AddSegment
Summary
  Adds a segment profile to the SegmentProfiles dataset.
Description
  This method is designed to be called by the BuildProfile method and uses TDataSet compatible code.
Parameters
  SegmentId    - The segment id of the segment being added.
  OwnerLoopId  - The loop id the segment is contained in.
  ParentLoopId - The parent loop id of the loop the segment is contained in.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.BuildProfile
Summary
  The main method called to build a profile from an EDI specification file.
Description
  This abstract method is designed to be overridden so other EDI specification file formats can be
  supported by the TJvEDIDBProfiler component.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.ClearProfile
Summary
  Completely clears all of the profile datasets.
Description
  This method uses TDataSet compatible code.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.ElementExist
Summary
  Determines if the element profile already exists in the ElementProfiles dataset.
Description
  This method is designed to be called by the BuildProfile method and uses TDataSet compatible code.
Parameters
  SegmentId - The segment id of the segment that the element is contained in.
  ElementId - The element id of the element.
Return value
  If the element profile is found then the function returns True.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.ElementProfiles
Summary
  The dataset that contains element profiles.
Description
  The element profile is the collection of elements with the maximum length and usage used in a segment
  in transactions across all profiled EDI specification files.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.LoopExist
Summary
  Determines if the loop profile already exists in the LoopProfiles dataset.
Description
  This method is designed to be called by the BuildProfile method and uses TDataSet compatible code.
Parameters
  OwnerLoopId  - The loop id of the loop.
  ParentLoopId - The parent loop id of the loop.
Return value
  If the loop profile is found then the function returns True.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.LoopProfiles
Summary
  The dataset that contains loop profiles.
Description
  The loop profile is the collection of loops and their relationships in transactions of all profiled
  EDI specification files.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.OnAfterProfiledSegment
Summary
  The event that occurs after a segment has been profiled.
Description
  The event is used to advance progress bars and update status indicators.
Parameters
  Segment - This parameter must be cast to its proper type in order to use it in an event handler.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.OnAfterProfiledTransactionSet
Summary
  The event that occurs after a transaction set has been profiled.
Description
  The event is used to advance progress bars and update status indicators.
Parameters
  TransactionSet - This parameter must be cast to its proper type in order to use it in an event
                    handler.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.SegmentExist
Summary
  Determines if the segment profile already exists in the SegmentProfiles dataset.
Description
  This method is designed to be called by the BuildProfile method and uses TDataSet compatible code.
Parameters
  SegmentId    - The segment id of the segment.
  OwnerLoopId  - The loop id the segment is contained in.
  ParentLoopId - The parent loop id of the loop the segment is contained in.
Return value
  If the segment profile is found then the function returns True.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.SegmentProfiles
Summary
  The dataset that contains segment profiles.
Description
  The segment profile is the collection of segments and their loop relationships in transactions of all
  profiled EDI specification files.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBProfiler.UpdateElement
Summary
  Updates element profile data.
Description
  This method is designed to be called by the BuildProfile method and uses TDataSet compatible code.
Parameters
  SegmentId     - Parameter used to locate correct record for update.
  ElementId     - Parameter used to locate correct record for update.
  ElementType   - Parameter
  MaximumLength - If the parameter value is greater than the current value then the current value is
                   updated.
  Count         - If the parameter value is greater than the current value then the current value is
                   updated.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBSEFProfiler
<TITLEIMG TJvEDIDBSEFProfiler>
JVCLInfo
  GROUP=JVCL.EDI
  FLAG=Component
Summary
  Use this component for building a profile from SEF files.
Description
  A descendent of TJvEDIDBPrifiler that works with the SEF file format.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBSEFProfiler.BuildProfile
Summary
  See TJvEDIDBProfiler.BuildProfile
Description
  See TJvEDIDBProfiler.BuildProfile
Parameters
  EDISEFFile - The SEF file object to be profiled.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBSpecProfiler
<TITLEIMG TJvEDIDBSpecProfiler>
JVCLInfo
  GROUP=JVCL.EDI
  FLAG=Component
Summary
  Use this component for building a profile from EDI SDK specification files.
Description
  A descendent of TJvEDIDBPrifiler that works with a native EDI specification file format used in the
  EDI SDK project on SourceForge.

----------------------------------------------------------------------------------------------------
@@TJvEDIDBSpecProfiler.BuildProfile
Summary
  See TJvEDIDBProfiler.BuildProfile
Description
  See TJvEDIDBProfiler.BuildProfile
Parameters
  EDIFileSpec - The EDI SDK EDI specification file object to be profiled.

----------------------------------------------------------------------------------------------------
@@TJvEDIFieldDef
Summary
  A specific field definition type for use with TJvEDIDBBuffer type components.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIFieldDef.DataType
Summary
  The TFieldType equivalient of FieldType.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIFieldDef.FieldName
Summary
  The field name.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIFieldDef.FieldType
Summary
  The EDI field type.
Description
  Usually assigned to one of the following constants: EDIDataType_Numeric, EDIDataType_Decimal,
  EDIDataType_Identifier, EDIDataType_String, EDIDataType_Date, EDIDataType_Time, or
  EDIDataType_Binary. Custom values can also be assigned.

----------------------------------------------------------------------------------------------------
@@TJvEDIFieldDef.MaximumLength
Summary
  The maximum field length.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIFieldDef.UpdateStatus
Summary
  The update status of the field.
Description
  Can have one of the following values: usUnmodified, usModified, usInserted, or usDeleted.

----------------------------------------------------------------------------------------------------
@@TJvEDIFieldDefs
Summary
  A specific field definitions collection type for use with TJvEDIDBBuffer type components.
Description
  None.

----------------------------------------------------------------------------------------------------
@@TJvEDIFieldDefs.Add
Summary
  Add a field definition.
Description
  None.
Return value
  Returns the index of the added item.

----------------------------------------------------------------------------------------------------
@@TJvEDIFieldDefs.Items
Summary
  Items property.
Description
  None.
Parameters
  Index - Index of field definition to get.

----------------------------------------------------------------------------------------------------
@@TJvResolveFieldDefTypeEvent
<TITLE TJvOnResolveFieldDefTypeEvent type>
<COMBINE TJvEDIDBBuffer.OnResolveFieldDefType>

----------------------------------------------------------------------------------------------------
@@TJvTableExistsEvent
<TITLE TJvTableExistsEvent type>
<COMBINE TJvEDIDBBuffer.OnTableExists>

----------------------------------------------------------------------------------------------------
@@TJvTableProfileEvent
<TITLE TJvOnTableProfileEvent type>
Summary
  A TJvEDIDBBuffer event.
Description
  The base event type for TJvCreateTableEvent, TJvCheckForFieldChangesEvent, and TJvAlterTableEvent.
Parameters
  FieldDefs - Field definitions for the table.
  TableName - A table name.

